PictureView plugin for Far
==========================
Скаков Павел, 10.06.2009
Maximus5, 17.10.2009


Описание
--------

 Плагин позволяет просматривать изображения различных графических форматов
 непосредственно из Far'а. (В том числе из архивов и виртуальных панелей.)


Запуск
------

 Плагин обрабатывает операции 'войти в архив' (по 'Enter' и 'Ctrl-PageDown'),
 'быстрый просмотр', 'просмотр' и 'редактирование', если соответствующее
 разрешено в настройках.

 Также его можно запустить из меню плагинов из панелей, просмотрщика и
 редактора или через префикс 'pic:' из командной строки. (При запуске из
 просмотрщика, редактора или из командной строки не на текущем файле
 возможности перехода на следующее/предыдущее изображение и изменения
 выделения отключаются.)


Декодирование
-------------

Начиная с mod13 плагин не имеет встроенных декодеров и работает с изображениями
только через PVD интерфейс. В поставку плагина входят несколько PVD декодеров,
позволяющих просматривать множество форматов изображений.


Отображение
-----------

 Для отображения используется DirectDraw:

  1. Без DirectX плагин не загрузится.

  2. Качество изображения сильно зависит от качества видеокарточки.
     В частности, если видеокарточка поддерживает аппаратное масштабирование,
      то плагин будет использовать именно его, а если нет - программную
      эмуляцию из DirectX.
     На особенно плохих видеокарточках может просто наблюдаться мусор вместо
      изображения.

  3. После декодирования изображение сразу целиком переносится в видеопамять -
      обычная память не тратится, но свободная видеопамять и прочие особенности
      видеокарточки определяют максимальный размер изображения.


Особенности работы
------------------

 Минимальная версия Far'а для запуска плагина - 2.0 build 1017.

 Родная операционная система для плагина - Win2003 SP2, но и на Win2000 и WinXP
 он должен работать не хуже. С остальными версиями Windows плагин не тестировался.

 При переходах следующее/предыдущее изображение в виртуальных панелях плагин
 вынужден отдавать управление Far'у. При этом он рассчитывает на то, что по
 команде 'войти в архив' на новом файле он сразу же вызовется. Если файл съест
 другой плагин или Far'у захочется показать какую-нибудь ошибку и плагин не
 получит управление обратно, то возможны весьма интересные эффекты... Если всё
 же это произошло, то рекомендуется запустить плагин на какой-нибудь картинке
 и выйти из него цивилизованно или просто перезапустить Far.

 После переключения на закрывающее Far окно или при переходе из полноэкранного
 режима в оконный иногда возникает эффект исчезновения картинки. Вызвано это
 внезапной перерисовкой Far'овского окна, о которой плагин догадаться не может
 ни как. Для восстановления изображения достаточно нажать одну из стрелок на
 клавиатуре, изменить масштаб или выполнить любую другую команду,
 перерисовывающую изображение.

 По Esc выходит более агрессивно (прерывает переходы и декодирование).
 // в версии 2.0 это вроде не работает.

 Быстрый просмотр... То, что это уже так работает - очень хорошо.
  Несколько замечаний:
   Текстовое окно всё же мерцает на долю секунды. Причём, после закрытия плагина.
   Бесполезно щёлкать мышкой вне изображения. (По нему - можно выйти.)
   При изменении размера Far'а плагин не будет пытаться это учитывать.
   Всегда автомасштабирование.

 Перехват просмотра и редактирования тоже не идеален - Far здесь работает весьма
 странно.
 Рекомендую открытие плагина по префиксу: "pic:!.!". В этом случае поведение
 плагина более стабильно.

 Если плагину разрешено обрабатывать операции 'войти в архив', 'быстрый просмотр',
 'просмотр' или 'редактирование', то рекомендуется запретить другим плагинам
 просмотра изображений из Far'а обрабатывать эти же действия.



Установка
---------

 1. Создайте подкаталог в каталоге Far\Plugins, например PictureView
 2. Распакуйте файлы из этого архива в получившийся каталог.
 3. При желании скачайте и установите дополнительные плагины декодеры:
    http://forum.farmanager.com/viewtopic.php?p=52480
 4. Перезапустите Far.


Лицензия
--------

Copyright (c) 2009 Skakov Pavel
All rights reserved.

Redistribution and use in source and binary forms, with or without
modification, are permitted provided that the following conditions
are met:
1. Redistributions of source code must retain the above copyright
   notice, this list of conditions and the following disclaimer.
2. Redistributions in binary form must reproduce the above copyright
   notice, this list of conditions and the following disclaimer in the
   documentation and/or other materials provided with the distribution.
3. The name of the authors may not be used to endorse or promote products
   derived from this software without specific prior written permission.

THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR
IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.
IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT,
INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT
NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.


Обратная связь
--------------

 Предложения, пожелания, баги и просто отзывы о работе плагина принимаются, но
 не стоит рассчитывать на дальнейшую активную разработку мной этого плагина.

 mailto: skakov@rain.ifmo.ru


Обратная связь развивающейся ветки (PictureView2 mod)
-----------------------------------------------------

 Форум:  http://forum.farmanager.com/viewtopic.php?p=1210
