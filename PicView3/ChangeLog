Changes by Maximus5

Picture View 3 history below

3.0.0
! Переделано все и вся.
! Версия для Far3. Far2 пока поддерживается, но не собирался и не тестировался.
+ Поддержка тачскринов
  * Two finger pan
    * Влево/вправо - листание файлов следующий/предыдущий
    * Вверх/вниз   - для многостраничных, листание страниц следующая/предыдущая
  * One finger pan
    * При автозуме - листание аналогично Two finger pan
    * При других значениях зума - прокрутка изображения
  * Two finger tap - переключение автозум/100%
  * Finger press and tap - пометка/снятие пометки с файла
  * Long tap - аналог RClick, закрытие картинки (выход)
+ В списках расширений можно указывать сигнатуры используя префикс ':'.
  Учтите, что сравнение идет по ANSI codepage. Для указания спец-символов
  можно использовать нотацию '\xx', где 'xx' две hex цифры. Также можно
  использовать стандартные '\r', '\n', '\t', '\s'. Собственно слеш - '\\'.
  Пример: :‰PNG,:BM,:AT&TFORM
  


Picture View 2 history below

ICO: Отображение только части у иконок размером более 255 пикселей (по стороне).

Mod25
% DX отваливался после WinL или CtrlAltDel.
% После выполнения {Unload, обновления плагина, Load} - плагин валился.
% DJVU 2.4: опять умеем работать с сетевыми файлами.
% В некоторых случаях после закрытия плагина в консоли оставались артефакты.
* Не реагировать на ShiftF3 при включенном '[x] Enter archive'.
* GDI+ теперь предпочитает работать с файлом а не с памятью.
* Добавлена опция 'Keep zoom only' (при листании изображений).

! Глобальная переделка движка плагина.
  * Декодирование изображений вынесено в отдельную нить.
  * Если нет панели (например, запуск из вьювера, или по префиксу) - плагин инициализирует список файлов из папки с просматриваемым изображением. Сохраняется полная функциональность, кроме возможности пометки элементов панели.
  * Стал возможным 'просмотр' папок. Пока это умеет делать только Shell - показывает эскиз папки, как в проводнике.
  % (в процессе) Переделано извлечение файлов из плагинов (архивов и пр.). При ошибке архива - переходим к следующему файлу. Собственно извлечение выполняется макросом через CtrlShiftF3.
  % (в процессе) После окончания зума (если позволяет активный декодер) выполняется улучшенный рендеринг изображение в разрешении, соответствующему текущему масштабу.
  % (в процессе) Кеширование файлов с медленных носителей и сети.
  % (в процессе) Кеширование фреймов анимированных и многостраничных изображений.
* При невозможности декодировать какой-либо файл общее количество в заголовке окна уменьшается а номера файлов корректируются.


Mod24
% В полноэкранном режиме не работали комбинации клавиш с Alt.
% При активации плагина по перехвату View/Edit не срабатывало автомасштабирование.


Mod23
% Родительское окно (FAR Manager'а) невидимое.


Mod22
* Option 'Rotate on EXIF' в _декодере_ GDI+.
* Зависания Qview при работе в ConEmu при включенном PanelViews.
* В WIC по умолчанию запрещено декодирование '*.gif'.
* На основной клавиатуре продублированы Gray+, Gray-, Gray*, Gray/.
* Косметика в диалоге конфигурации.


Mod21
* Help updated (Main plugin settings -> Process actions).
* Если при открытии вьювера/редактора (включены флажки View или Edit в настройке) зажат CtrlShift - плагин не активируется. То есть по CtrlShiftF3 всегда будет показано содержимое файла. Для включения обратно - есть соответсвтующие флажки в диалоге настроек.
* При активации Viewer проверка переменной окружения "FarPicViewMode" чтобы не драться с Multimedia Viewer.


Mod20
* Не работало колесо в полноэкранном режиме.
* «[» и «]» теперь тоже листают файлы/страницы.


Mod19
* Не работала '*' в активных расширениях (Active extensions) и другие bugfixes выбора декодера.
* После открытия/закрытия QView следующее открытие полнооконной картинки выполнялось некорректно.
* Shell. Некоторые картинки не рендерились.
* ICO. Обучен открывать курсоры (*.cur) и иконки из ресурсов PE-файлов. В этом случае иконки обычно без расширения и не имеют требуемого заголовка ICO формата.
* Поправлен раздел help по настройке расширений декодеров.


Mod18
* При использовании декодера GFL и дисплея GDI+ некорректно отображались прозрачные картинки.
* При включенном "Keep zoom and pos between pictures" можно выбрать удерживаемую точку (центр или левый верхний угол).
* В шаблонах можно использовать '\B0' - битность, которую вернул декодер.
* Убиты зависания в некоторых случаях.
* Косметика для QView. Esc убирает картинку но в FAR не пропускается (панели не гасятся).


Mod17
* Ошибка позиционирования QView при некоторых настройках шрифта.
* Вроде бы убит баг с зависанием при зажатом Enter.
* Немного изменена логика настройки декодеров (из-за этого сменились имена параметров в реестре).
  Теперь есть 3 группы расширений: Active, Inactive, Forbidden.
  (!) Декодер никогда не будет вызван для файлов с расширением из группы Forbidden.
  Сначала PicView пытается подобрать декодер по группе Active
  Eсли ни один декодер не согласился открыть файл - то по группе Inactive.
  Если подбор по Inactive тоже не дал результата то при явном вызове плагина подбор будет проведен вообще без учета расширений (только с учетом группы Forbidden).
  Side effect: Если в Forbidden указать '*' - декодер будет 'отключен'.
* "Keep zoom and pos between pictures" теперь влияет и на зум.
* Правка ресурсов и помощи.
* При просмотре многостраничных не анимированных документов можно перейти на страницу по номеру. Введите цифрами на основной клавиатуре номер страницы и нажмите Enter (или подождите 2 секунды).
* При просмотре многостраничных документов действие модификаторов распространено на Home/End (и им подобных).
* При включенной 'Show selected first' при выходе из плагина выделенные файлы не перемещались вверх.
* Декодер Shell обучен понимать прозрачные картинки (кстати, в Win7 Shell чуть-чуть умеет смотреть ttf).
* Отладочные настройки в модуле DX.pvd.


Mod16d
(!) Автомасштабирование по ширине/высоте заменено на Fit/Fill.
* При явном вызове плагина (F11 или префикс) не учитываются игнорируемые расширения заданные глобально (в самом PicView).
* При явном вызове плагина если ни один декодер не подошел по расширению подбор проводится сначала без учета "поддерживаемых", потом без учета "игнорируемых".
* Вернул работу в Temp панели.
* Ключик в реестре "LogFileName" - ведение отладочного лог-файла.
* После обновления модуля его приоритет слетал на умолчательный.
* Ошибка позиционирования QView при некоторых настройках шрифта.
* Добавлен флажок "Держать масштаб и положение при смене изображений".
* Поддержка альфа-канала (прозрачности) в декодере WIC (PNG). Может ли он обработать прозрачность в форматах с палитрой пока не понятно.


Mod16c
* Если CMYK палитра не используется (выбрано Fast в настройках) - то и не загружаем CMYK.png.
* Поправлен плавный скроллинг.
* DJVU.pvd в некоторых случаях падал.
* Усиленный подбор декодера выполняется только на первом файле серии при явном вызове плагина через меню или по префиксу.
* Кнопка-модификатор не выключалась, если плагин запускался "Входом в архив".
* Затычка от непрорисовки при деактивации/активации окна FAR.


Mod16b
* Плагин мог валиться после загрузки нового модуля.
* Блокировка слишком быстрого скроллинга в GDIPlus.


Mod16a
* Эксперимент по переименованию DLL плагина признан неудачным: вернулось старое имя с ноликом, добавлена проверка имени при старте плагина.
* Исправлена кучка ошибок версии Mod16.
* При попытке загрузить новый модуль по префиксу возникала ошибка.
* CMYK.png обрабатывается самим PicView и в декодеры больше не уходит.
* Немного поправлен хелп.


Mod16
* (!) Переименована DLL плагина (PictureView2.dll и PictureView2.x64.dll). Удалите старые 0PictureView*.dll
* (!) Настройки сохраняются в новой ветке реестра "PictureView2". Небольшой перетрях умолчаний.
* В меню плагинов имя плагина "Picture View 2".
* Добавлена настройка префикса плагина.
* "Нативная" поддержка рендеринга в экранном разрешении.
** Пока что рендерингу в заданном разрешении (антиалиасинг) обучены DJVU.pvd и WIC.pvd.
** Чтобы после увеличения изображения улучшить его качество - нажмите F5. Картинка будет отрендерена в разрешении соответствующем текущему зуму.
*** SideEffect. К сожалению, после F5 выбирается декодер по умолчанию.
* Добавлены шаблоны для информационных строк QView (вкладка [4OSD]).
* Шаблон заголовка перенесен на вкладку [4OSD].
* Увеличена точность тайминга, учитывается время первой отрисовки.
* При случайном улистывании с файла и возврате обратно (а также при повторном открытии после Esc) восстанавливается открытая страница.
* Цвет фона для QView задается отдельно. Совсем немножко AI при определении его умолчательного значения.
* При листании многостраничного документа в сторону увеличения страниц - прокрутка сбрасывается в верхний левый угол (для удобства чтения).
? Вроде бы FAR больше не должен виснуть во время работы PicView? Проверьте? Убирать соответствующие предупреждения из хелпов и ридми?


Mod15d
* В шаблон заголовка добавлено:
** Условие '\W' - наличие/отсутствие информации о размере изображения.
** Укороченное имя файла '\NLxxx', где xxx - сколько символов отображать в заголовке.
* Добавлена кнопка [Reset] для title template.
* PicView мог зацикливаться, если ни один модуль дисплея не соглашался отобразить картинку.
* GDI+ не открывал некоторые файлы (WMF,EMF).
* Если декодер не вернул название формата - PicView считает названием формата расширение файла.
* Добавлен декодер Shell Thumbnails. Список расширений формируется исходя из установленных в системе интерфейсов.
* В декодере WIC список расширений формируется исходя из установленных в системе WIC кодеков.
* В некоторых случаях плагин закрывался по F5, (AltShift)F9, AltPgUp, AltPgDn.
* Информация о модуле вынесена в отдельный диалог (F3).


Mod15c
* Попытки изничтожить подвисания консоли (F1, F9 и прочая).
* В диалог настроек добавлена вкладка '5Log', где показываются все ошибки по всем модулям.
* Любые изменения в диалоге настроек (при открытой картинке) применяются по OK сразу (F5 больше не нужен).
* Некоторые изменения в управлении.
** <Left DblClick>: FullScreen.
** <Gray *>: Zoom 100% / Autozoom by width / by height.
** Ctrl-<Gray *>: Zoom 100%.
** <Middle Mouse Button>: Switch Autozoom/100%.
* 'Усиленный' подбор декодера (без учета обрабатываемых расширений) выполняется только для первой картинки серии.
* Игнорируемые расширения больше не игнорируются даже при 'усиленный' подборе декодера.
* Если активный модуль дисплея отказывается отобразить картинку - пытаемся работать через другой модуль дисплея.
* При выводе через DX пытаемся проверять объем свободной видепамяти, и если ее не хватает - DX отказывается отображать картинку (PicView переходит к следующему дисплею).
* DX выводит в лог информацию о видеопамяти (Total & Free).
* Изменения в стилях окна. По идее, теперь консоль будет реже 'затирать' картинку.
* PVD API: PVD_IDPF_ZOOMING, PVD_IDPF_PANNING.
* Добавлен простенький декодер-дисплей для WFM/EMF файлов (ибо GFL гадит в консоль).
* Недоступные или 'приватные' дисплеи в списке выбора активного дисплея засерены.


Mod15b
* Русский help и файл ресурсов в UTF-8.
* На вкладке модулей доступные хоткеи динамически обновляются.
* Теперь при листании файлов для каждого нового файла декодер подбирается заново. Ранее - использовался декодер предыдущего изображения.
* Субплагин декодера/дисплея может при декодировании затребовать собственный вывод на экран.
* Разрешено одновременное использование нескольких модулей дисплея. Требуемый модуль определяется по настройкам и требованиям активного декодера.
* В настройке GDI+ добавлен флажок 'Forced self display'. При его включении вывод на экран пойдет через GDI+ даже если 'умолчательным' назначен DirectX.
* Вывод через GDI+ не работал с декодером DjVu.


Mod15a
* Не работал zoom колесом мышки.
* Не работал drag левой кнопкой при выходе за пределы окна FAR (и никогда не работал...)
* Немного улучшен GDI+.Display. Открытие - быстро, первый зум - медленно, потом опять быстро. При зуме сбрасывается алиасинг.


Mod15
* Инициализация плагина разнесена на несколько шагов, дабы не загружать модули и CMYK.png по любому обращению к редактору/вьюверу.
* Доработан диалог настройки субплагина (поле Features).
* Встроенный интерфейс вывода через DX погиб смертью храбрых.
** Вместо него можно использовать DX.pvd или GDI+.pvd.
** Текущий модуль вывода выбирается на вкладке модулей диалога настроек.
** Имя текущего модуля вывода можно показать в заголовке окна - '\R'.
** О модуле вывода GDI+.
*** Собственно отрисовка работает ожидаемо медленнее (zoom, scroll, etc.)
*** Время открытия изображения при использовании декодера GDI+ значительно снижено.
*** Может быть использован при работе в терминальной сессии.
** Желающие могут спокойно поиграться с выводом через DX10 или OpenGL, ибо теперь интерфейс позволяет...
* Некоторые потуги поддержки нескольких мониторов. FullScreen распахивается на мониторе с окном FAR.
* Несколько изменено управление масштабированием.
** Масштабирование колесом мышки - при удержании Alt.
** Масштабирование <Gray+> и <Gray-> как раньше (Alt переключает плавное масштабирование).
** ShiftPgDn/ShiftPgUp и прочие кнопки листания масштабированием больше не занимаются.
* Несколько изменено управление листанием.
** Добавлена кнопка-модификатор (выбирается из Caps/Scroll/Num) при включении которой инвертируется значение удерживания кнопки Ctrl при нажатии кнопок листания.
** Кнопку-модификатор можно автоматически включить/выключать при открытии первого изображения серии (для многостраничных НЕ анимированных - включается, иначе - выключается).


Mod14a
* Ошибка обработки CMYK.


Mod14
* Вместо F2 теперь есть F9 (открыть страницу декодеров и выделить активный) и AltShiftF9 (первая страница диалога настроек). Чтобы настройки применились к открытому изображению нужно нажать F5.
* Заголовок ставится в начале работы плагина, а не когда какой-либо декодер вернет картинку.
* При переборе декодеров - заголовок обновляется.
* AltPgDn/AltPgUp - переоткрыть текущую картинку следующим/предыдущим декодером.
* В диалоге настройки декодера добавлены кнопки 'Reload' и 'Unload'.
* pic:load:..., pic:unload:..., pic:reload... - префиксы для загрузки/выгрузки декодеров.
* PicView теперь умеет отображать картинки в CMYK (естественно, если CMYK умеет возвращать текущий декодер).
* Добавлена настройка 'CMYK to RGB processing'. Fast: быстрое но наименее точное преобразование. Approximate: для преобразования используется 'сетка' 16x16x16x16. Precise: то же что Approximate, но результат 'уточняется' по двум точкам. Все преобразования выполняются программно, что может занимать дополнительное время.
* В настройках декодера GFL добавлен флажок 'Convert CMYK to RGB internally'. По умолчанию выключен (преобразованием CMYK->RGB занимается PicView). При включении флажка CMYK->RGB выполняет сам GFL, хотя у него это не очень получается.
* Доработан русский help, добавлено описание по каждому декодеру.
* Допускается уточнение декодером количества страниц.


Mod13
* Все встроенные декодеры погибли смертью храбрых.
* Переработан PVD интерфейс.
** Добавлены PVD декодеры для GDI+, GFL, ICO.
** Загрузка декодера выполняется только при необходимости (первом обращении к нему). Параметры декодеров кэшируются в реестре.
** Настройки декодеров можно изменить через интерфейс плагина или через реестр (путь к Dll'кам, обрабатываемые и игнорируемые расширения, порядок декодеров, и пр.).
** Прозрачность и частичная прозрачность для всех декодеров/форматов (если прозрачность поддерживается декодером).
** Честное отображение времени открытия/декодирования.
** В шаблоне заголовка модификатор '\E' == '<открытие>+<декодирование>+<отображение>'.
** В диалоге настройки декодера поле 'Subplugin status', где можно посмотреть последнюю ошибку декодера (почему изображение не было открыто, и т.п.).
* Минимальная версия FAR2 build 1017.
* PVD декодер для AcdSee плагинов можно скачать здесь: http://forum.farmanager.com/viewtopic.php?p=52480#p52480


Mod11
* Настройки плагина в некоторых случаях не загружались.
* Добавлены умолчательные расширения в "Ignored extensions". Там же - кнопка "Reset".
* Не открывались файлы с длинными путями (пока макс.длина пути увеличена до 0x1000).


Mod10
* Плагин инициализируется (грузит *.pvd) только при необходимости.
* FAR2 build 1145
* DJVU.pvd включен в поставку. Runtime и libdjvulibre.dll не требуются.


Mod9
* Плагин падал вместе с фаром при вызове по F11 из вьювера.
* Плагин ошибочно активировался при поиске файлов с включенным флажком "Search in archives".


Mod8
* Потихоньку пишем английский хелп. Правки и дополнения приветствуются.
* Минимальное время фрейма (GDI+) установлено в 100 мс.
* При отображении в заголовке порядкового номера файла и количества файлов ошибочно учитывались папки и "..".
* Юникодный плагин теперь может работать с Ansi GFL :-D
* Некоторые pvd могли не работать, если вызов плагина шел из Edit/View.
* Файлы 0-го размера больше просматривать не пытаемся.
* В Mod6 отвалилось сохранение "Расширенных настроек".
* Вернулась возможность использовать "\{S* \}" в "Title template".
* Модуль Djvu.pvd и сопутствующие библиотеки пересобран без Msvcr90.dll. Появилась версия для x64.
* При открытии диалога конфигурации x64 версия валилась.


Mod7
* Принудительный выбор декодера не работал для PVD.
* Добавлена поддержка DJVU-формата в виде PVD модуля (FAR1 & FAR2 x86 only).


Mod6
* Перетрях диалога настроек - диалог теперь содержит несколько 'вкладок'.
* Опция 'Mark by Space' в настройках (по умолчанию выключена). При ее включении пробел сначала помечает файл и только потом переходит к следующему.
* Добавлена возможность принудительного выбора декодера для файлов с указанным расширением (диалог настроек, страница Декодер).


Mod5
* При использовании GFL плагин ищет в своей директории файл libgfl*.dll (рекомендуется версия 3.11), а не пытается тупо загрузить libgfl290.dll
* libgfl311.dll включен в поставку
* Статическая линковка с ddraw заменена на динамическую


Mod4
* Internal build.

Mod3
* Internal build.

Mod2
* Сборка для FAR2 build 995.

Mod1
* Добавлена поддержка ConEmu.
