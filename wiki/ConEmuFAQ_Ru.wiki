<font size="6">Содержание</font>
<wiki:toc max_depth="3" /> 

==О главном==

===Q. Что делать, если нашли ошибку?===
A. Сначала проверить, повторяется ли ошибка БЕЗ !ConEmu, в 'чистом' FAR? Если не повторяется - проверить последнюю версию !ConEmu. Качать здесь:
http://code.google.com/p/conemu-maximus5/downloads/list
Если ошибка не исправлена - создавайте Issue с подробным описанием:
http://code.google.com/p/conemu-maximus5/issues/list

===Q. А как же !ConMan, альтернативная консоль и пр.?===
A. Все встроено в !ConEmu, только лучше ;) Флажок '!MultiCon' должен быть включен. Более того, использование !ConMan вместе с !ConEmu НЕ РЕКОМЕНДУЕТСЯ. Новую консоль можно создать как шорткатом (Win-W по умолчанию), так и добавлением к выполняемой команде параметра -new_console. Можно закрыть или перезапустить текущую консоль (Win-~). Длинный вывод последней консольной команды/программы можно посмотреть через плагин в редакторе или просмотрщике (макрос на Ctrl-O). Переключение между консолями Win-Q. Переключение между консолями и окнами Ctrl-Tab.

===Q. Для чего нужен сертификат !ConEmu.cer (digital certificate)?===
A. Для проверки целостности исполняемых файлов !ConEmu.

A. Если сертификат импортирован в корневые доверенные сертификаты (для пользователя, компьютера или домена) то при запуске !ConEmu в режиме администратора (Vista & Win7) в запросе UAC вместо злобного окна с "непроверенным издателем" отображается нормальное имя программы и "проверенный издатель: !ConEmu-Maximus5".

A. Если сертификат импортирован в корневые доверенные сертификаты антивирусы (например KIS) будут считать программу доверенной.

===Q. Как импортировать в корневые доверенные сертификаты?===
A. В Vista+ можно просто 'запустить' файл сертификата и нажать кнопку 'Установить сертификат'.

A. С помощью утилиты !CertMgr из Windows SDK:
{{{
   "C:\Program Files\Microsoft SDKs\Windows\v7.0\Bin\CertMgr" -add -c ConEmu.cer -s root
}}}

A. Через MMC -> оснастка Certificates.

===Q. Отображаются не все символы (иероглифы, троеточие, копирайты, и др.)===
A. По какой-то причине !ConEmu не смог сменить шрифт у реальной консоли. Выберите пункт системного меню окна !ConEmu 'Properties' и на закладке 'Шрифт' выберите !TrueType шрифт.

A. В настройке (Settings-!ConEmu.reg, параметр '!ConsoleFontName') указан НЕ юникодный или отсутсвующий шрифт для консоли.

===Q. Можно ли запустить во вкладке !ConEmu графическое (GUI) приложение?===
A. Да, некоторые GUI приложения можно. Например Putty, Notepad, и т.п.

===Q. Как запустить приложение в новой владке !ConEmu?===
A. Указать приложение в поле 'Create new console' окна подтверждения создания новой консоли. Это окно можно вызвать из системного меню !ConEmu «New console...» или с клавиатуры (по умолчанию это Win-W или Win-Shift-W).

A. Новую вкладку можно открыть из уже запущенной вкладки (например, из Far) используя параметр запуска '-new_console'. Например: `putty.exe -new_console`.

===Q. Как использовать параметр '-new_console'?===
A. В настройке !ConEmu должен быть включен флажок «Inject !ConEmuHk». После этого, если !ConEmu видит в строке запуска приложения/команды параметр '-new_console' он убирается из строки запуска, а приложение/команда выполняется в новой вкладке !ConEmu.

A. Можно использовать дополнительные опции запуска: `-new_console[:bh[N]caru[:user:pwd]]`
   * `b` - Create background tab
   * `h<height>` - пример, h0 - отключить буфер, h9999 - включить буфер в 9999 строк
   * `n` - отключить 'Press Enter or Esc to close console'
   * `c` - принудительно включить 'Press Enter or Esc to close console' (default)
   * `a` - !RunAs shell verb (as Admin on Vista+, login/password in Win2k and WinXP)
   * `r` - Run as restricted user
   * `u` - !ConEmu choose user dialog
   * `u:<user>:<pwd>` - specify user/pwd in args, MUST BE LAST OPTION
*Пример:* `dir "-new_console:bh9999c" c:\ /s`

A. Для удобства использования в Far можно установить макрос на !ShiftEnter (см. примеры в дистрибутиве).

===Q. Какие переменные окружения устанавливает !ConEmu?===
A. `ConEmuDir` - папка, содержащая !ConEmu.exe; `ConEmuBaseDir` - папка, содержащая ConEmuC.exe; `ConEmuArgs` - аргументы, с которыми был запущен !ConEmu.exe; `ConEmuHWND` - дескриптор дескриптор окна виртуальной консоли (дочернее окно !ConEmu).


==Дистрибутив==

===Q. Почему дистрибутив содержит не все файлы? Я не нашел !ConEmu64.exe...===
A. «Дистрибутив» - это файл «!ConEmuSetup.XXXXXX.exe», 7z-архив содержит только минимально-необходимое. exe-файл содержит как x86 так и x64 версии msi-инсталляторов. Использовать exe-инсталлятор рекомендуется на компьютерах с включенным UAC (Vista и выше) если вы хотите установить !ConEmu в 'Program Files'.

===Q. Для чего нужен процесс ConEmuC.exe (!ConEmuC64.exe)?===
A. Это 'консольная' часть !ConEmu. Через него графическая оболочка получает всю информацию о консоли. Этот процесс управляет автоматическим увеличением высоты буфера консоли при запуске команд/приложений. При запуске 'новой' консоли (Shift-Enter в FAR) прицепляет ее к !ConEmu.

===Q. Зачем нужен Far-плагин !ConEmu.dll (!ConEmu.x64.dll)?===
A. Это модуль, обеспечивающий связь между Far Manager и !ConEmu.
  * Без него не работают некоторые расширенные возможности (табы, Drag'n'Drop).
  * Без него не включается !TrueColor в Far 3.x.
  * Без него не будут работать некоторые другие плагины (!FarHints например).
  * Показывает скрытую консоль с FAR-ом, если случилось несчастье и !ConEmu упал.
  * После детача консоли (Ctrl-Alt-Tab) запускает новый !ConEmu для новой консоли.
  * Необходим для работы с длинным буфером вывода консольных приложений.

===Q. Для чего нужен файл !ConEmuHk.dll (!ConEmuHk64.dll)===
A. Это модуль, внедряемый в приложения, запускаемые в !ConEmu. Необходим для реализации некоторых опций, а также исправляет многие проблемы, проявляющиеся как в !ConEmu, так и без него.
  * всплывание GUI-диалогов (без него они окажутся позади !ConEmu);
  * корректную работу GUI-EMenu (без !ConEmuHk`*`.dll оно не закрывается);
  * обеспечивает работу флажков "No zone check", "Ascii sort...";
  * обеспечивает работу параметра "-new_console";
  * лечит проблемы !ShellExecute (когда вывод батников не всегда виден в консоли);
  * лечит зависания chcp;
  * обеспечивает мониторинг "Shell and processes";
  * внедрение GUI приожений во вкладку !ConEmu, и т.п.

===Q. Для чего нужен файл !ExtendedConsole.dll (!ExtendedConsole64.dll)?===
A. Это поддержка расширенной консоли в Far 3.x, должен располагаться в каталоге с файлом Far.exe. При его наличии и включении флажка «!TrueMod support» в Far можно настроить любые !TrueColor цвета и стили (bold/italic/underline).


==Обновление==
===Q. Умеет ли !ConEmu обновляться автоматически?===
A. Да. !ConEmu может проверять наличие новых версий при запуске, ежечасно или по запросу пользователя (SystemMenu -> Help -> Check for updates).

===Q. Какие возможности у автоматического обновления?===
A. Вы можете настроить обновление так, как вам хочется.
  * Возможна работа через Proxy.
  * Можно проверять наличие как «стабильных» так и «alpha» сборок.
  * При обнаружении новой версии можно отображать запрос на загрузку, а можно загружать пакет (архив или инсталлятор) сразу.
  * Если !ConEmu был установлен через инсталлятор, то при совпадении пути установки с путем запущенного ConEmu.exe (или ConEmu64.exe) обновление производится через пакет «!ConEmuSetup.XXXXXX.exe».
  * 7-zip архив не содержит файла ConEmu64.exe, поэтому 64битную версию GUI можно обновить только через инсталлятор.
  * В других случаях можно обновляться из 7-zip архива.
  * Для обновления через архив на компьютере должен быть установлен архиватор ([http://www.7-zip.org/ 7-Zip] или [http://www.rarlab.com/ WinRar]).
  * По умолчанию пакеты скачиваются в %TEMP% и удаляются после установки.
  * Но, вы можете указать любую папку, в которую нужно скачивать пакеты обновления. Их можно не удалять после установки.
  * Команда установки выполняется из временного cmd-файла, выполяемого в папке с ConEmu.exe. cmd-файл создается в %TEMP%.
    * Команда инсталлятора по умолчанию: `"%1" /p:%3 /qr`. Запускает соответствующий (x86/x64) msi-пакет с ключом `/qr` (обновление «без вопросов»).
    * Команда архиватора по умолчанию: `<архиватор> x -y "%1"`. Вместо `<архиватор>` указывается полный путь к любому архиватору, поддерживающему распаковку 7-Zip архивов: 7zg.exe, 7z.exe, Unrar.exe, WinRar.exe, и т.п.
  * После успешного обновления вы можете выполнить любую команду или скрипт (через cmd.exe). Например, вы можете скопировать новые файлы в другие папки, если на вашем компьютере установлено несколько копий !ConEmu. По умолчанию, в папке с !ConEmu.exe создается файл !ConEmuUpdate.info с информацией о дате и времени последнего обновления.
  * Информацию о новых версиях !ConEmu получает по [http://conemu-maximus5.googlecode.com/svn/trunk/ConEmu/version.ini этому адресу]. В случае необходимости (например, централизованное обновление компьютеров в сети?) адрес можно изменить через reg/xml (поле "Update.VerLocation").


==x64 issues==

===Q. Зачем нужны файлы ConEmuC.exe, ConEmuCD.dll и !ConEmuHk.dll в 64битных ОС?===
A. Эти файлы необходимы для запуска 32битных приложений, а также для работы 32битной версии !ConEmu.exe. Наверняка в какой-то момент вам окажется необходимо запустить 32битную консольную программу. Без этих файлов это не получится. В принципе, можно пользоваться 64битной версией !ConEmu64.exe, которая доступна в дистрибутиве «!ConEmuSetup.XXXXXX.exe», она запускает !ConEmuC64.exe в качестве корневого консольного процесса.

===Q. Зачем нужны файлы !ConEmuC64.exe, ConEmuCD64.dll и !ConEmuHk64.dll в 32битной версии !ConEmu?===
A. Эти файлы необходимы для запуска 64битных приложений в 64битных ОС.

===Q. При запуске команд start, echo (и прочих команд cmd.exe) на 64битной ОС возникает ошибка вида "File not found. Cannot execute. start".===
A. Скорее всего вы удалили необходимый файл !ConEmuC64.exe и сопутствующие !ConEmuHk64.dll, ConEmuCD64.dll.

===Q. При попытке запуска (из Far Manager) возникает системная ошибка вида: «Ошибка при запуске приложения (0xc0000142). Для выхода из приложения нажмите кнопку "OK".»===
A. Причина пока не найдена, какая-то проблема в Windows. Причем, ошибка возникает не только в !ConEmu, но и в 'чистой' консоли. Для восстановления нормальной работы нужно перезапустить консоль (например через Win-~).

===Q. Что происходит с переменными окружения в 64битных OS?===
A. !ConEmu не управляет переменными окружения.


==Настройка==

===Q. Можно ли запустить !ConEmu так, чтобы в нем сразу было открыто несколько вкладок: Far, CMD, !PowerShell?===
A. Можно. Для этого используйте командный файл запуска. Например *startup.txt*:
{{{
>E:\Source\FARUnicode\trunk\unicode_far\Debug.32.vc\far.exe
*/BufferHeight 400 cmd
/BufferHeight 1000 powershell
}}}
и запускайте !ConEmu так:
{{{
conemu.exe /cmd @startfile.txt
}}}
В файле каждая строка соответсвует запускаемой команде.
Допустимо указание в строке параметра /!BufferHeight для установки высоты консольного буфера.
Если в начале строки стоит "`>`" - эта консоль будет активной после завершения запуска.
Если в начале строки стоит "`*`" - эта консоль будет запущена под администратором.

===Q. Двоятся окна Far manager.===
A. Это просто консольное окно не спряталось. Проверьте флажок 'Visible' на вкладке настроек 'Features' или значение в реестре:
{{{
[HKEY_CURRENT_USER\Software\ConEmu\.Vanilla]
"ConVisible"=hex:00
}}}

===Q. Как настроить растровый шрифт?===
A. Это шрифт Terminal. Например консольный '8 x 12' это 'Terminal 12 x 8' в !ConEmu, '12 x 16' -> 'Terminal 16 x 12', и т.п.
   Внимание: В поле 'Charset' необходимо выбрать 'OEM'.
   Лично мне нравится 'Fixedsys 16 x 8', которого в обычной консоли нет.
   Примечание: В списке шрифтов можно сразу выбрать `[Raster Fonts 8x12]`.


==Far Manager==

===Q. Почему не работают табы (вкладки)?===
A. Плагин !ConEmu.dll (!ConEmu.x64.dll) установлен? Флажок 'Enable Tabs' в настройке включен? Если флажок в 'третьем состоянии' табы появляются только после открытия редактора/вьювера.

===Q. Почему щелчок правой кнопкой мышки по табу закрывает редактор/вьювер/фар?===
A. 'Правый щелчок' активирует вкладку и сразу посылает в фар кнопку F10. Вы можете переопредлить макрос закрытия владки в реестре:
{{{
[HKEY_CURRENT_USER\Software\ConEmu\.Vanilla]
"TabCloseMacro"="F10"
}}}

===Q. В Far не передаются нажатия кнопок мышки, колесо.===
A. Проверьте настройку Far -> Interface settings -> `[x]` Mouse.

A. Если Far работает в режиме «far /w» (System\!WindowMode=1) то необходимо наличие плагина !ConEmu.dll (!ConEmu.x64.dll), иначе !ConEmu будет считать что сейчас работает обычное консольное приложение типа cmd.exe в которое событие мышки посылать не нужно.

===Q. Почему не работает плагин !FarHints?===
A. Его необходимо обновить (версия 1.0.15 и выше) и он требует наличия плагина !ConEmu.dll (!ConEmu.x64.dll).

===Q. В какой-то момент перестают работать табы, Drag-n-Drop,...===
A. Посмотрите на вкладку 'Info' диалога настроек. Скорее всего отключился флажок 'Far' или 'Panels'. Учтите, что для D&D необходим плагин !ConEmu.dll (!ConEmu.x64.dll).

===Q. По щелчку правой кнопкой мышки не появляется контекстное меню для файла/папки.===
A. Не включен флажок '!RightClick 4 context menu'? Если флажок в 3-м состоянии - меню появляется после 'долгого' клика, дождитесь пока замкнется кружок вокруг курсора мышки.

A. По какой-то причине !ConEmu не обнаружил 'панели' в Far. Может быть не установлен плагин !ConEmu.dll (!ConEmu.x64.dll)? Если все-таки установлен - присылайте скриншоты !ConEmu, вкладки Info окна настроек и файл 'Dump screen...' (системное меню !ConEmu -> Debug -> Dump screen...).

===Q. По щелчку правой кнопкой мышки появляется графическое меню, а хочу текстовое.===
A. Соответствующий макрос можно указать в реестре (или xml), например:
{{{
[HKEY_CURRENT_USER\Software\ConEmu\.Vanilla]
"RightClickMacro2"="F11 e Enter"
}}}
Предполагается, что для EMenu назначен hotkey 'e'.


==Windows Vista==

===Q. В Windows Vista не срабатывает комбинация Ctrl-Win-Alt-Space для показа !RealConsole.===
A. Почему-то первое наатие пробела вистой иногда 'проглатывается'. Не отпуская Ctrl-Win-Alt нажмите пробел еще раз.

===Q. В Windows Vista зависают другие консольные процессы.===
A. "Виноват" процесс !ConIme.exe. Вроде бы он служит для ввода иероглифов (китай и т.п.). Зачем он нужен, если ввод теперь идет в графическом окне? Нужно запретить его автозапуск или вообще переименовать этот файл, например в '!ConIme.ex1' (видимо это возможно только в безопасном режиме).
Запретить автозапуск: Внесите в реестр и перезагрузитесь
{{{
[HKEY_CURRENT_USER\Console]
"LoadConIme"=dword:00000000
}}}


==Аварийные завершения==

===Q. При завершении консольной программы возникает ошибка вида: Access violation at address 6F78DE5B in module '!ConEmuHk.dll'. Read of address 0071004E===
A. Возможная причина - эта консольная программа порушила свою таблицу импортов. Решение - обратиться к ее разработчику. Для более точного вердикта "кто виноват" можно прислать мне минидамп.

===Q. Far зависает при выходе?===
A. Ни одного Issue на эту тему еще не было создано. Тем не менее, если Far завис при выходе, сделайте дампы памяти процессов Far.exe, ConEmuC`*`.exe и !ConEmu`*`.exe. Как это сделать смотрите ниже. Заархивировать и прислать файлы разработчику. Для создания правильного дампа 32битного приложения в 64битной ОС нужно использовать !ConEmu.

===Q. Как создать дамп памяти приложения?===
A. Windows XP и выше.
   Запустить `"ConEmuC.exe /DEBUGPID=ИД_Процесса"` и в появившемся окне нажать Ctrl-Break. Вам будет предложено сформировать дамп памяти процесса. `ИД_Процесса` можно посмотреть в Диспетчер задач Windows. Если процесс 64битный - запускать нужно "!ConEmuC64.exe".

A. Windows 7 и выше.
   _Внимание! Этот метод допустим только для процессов той же битности, что и OS. То есть создать корректный дамп для 32битного процесса в 64битной OS не получится. Открыть Диспетчер задач Windows, перейти на вкладку 'Процессы' и в контекстном меню выбрать пункт 'Создать файл дампа памяти'._

A. Дампы памяти умеет создавать утилита 'Process Explorer', но _с ее помощью создать корректный дамп для 32битного процесса в 64битной OS также не получится_.

===Q. Что означает: ConEmuC: !CreateFile(CONOUT$) failed, !ErrCode=0x00000005===
A. Запускаемая программа создала и установила в консоли собственный буфер,    созданный как `CreateConsoleScreenBuffer(..., 0/*No sharing*/, ...)`. Просите автора программы создавать буфер корректно, а не только для себя:
{{{
(GENERIC_READ|GENERIC_WRITE, FILE_SHARE_READ|FILE_SHARE_WRITE,...)
}}}


==Unsorted==

===Q. Как сворачивать !ConEmu в трей (в иконку рядом с часами)?===
A. Щелкнуть правой кнопкой по крестику в заголовке. Можно также включить флажок 'Auto minimize to TSA' в настройке. Тогда сворачивание в трей будет происходить автоматически при минимизации.

===Q. Зачем !ConEmu меняет шрифт у реальной консоли?===
A. В реальной консоли должен быть выбран !TrueType шрифт, иначе в !ConEmu вместо юникодных символов (иероглифы, троеточие, копирайты, и пр.) будут отображаться знаки вопроса ('?'). Так устроена консоль Windows.

A. Размер шрифта в реальной консоли должен быть меньше, чем !ConEmu, иначе будет невозможно увеличить размер !ConEmu (в символах) более того размера, который разрешен в Windows для текущего консольного шрифта.

===Q. Почему-то отображается только часть консоли; консоль отображается сдвинутой; не отображается вообще.===

A. В настройке (Settings-!ConEmu.reg) указан слишком большой консольный шрифт.

A. Возможно, выбрана слишком большая ширина окна (в символах).

A. Возможно, по какой-то причине !ConEmu не смог сменить шрифт у реальной консоли. Выберите пункт системного меню окна !ConEmu 'Properties' и на закладке 'Шрифт' выберите !TrueType шрифт и наименьший размер.

===Q. Почему исчезает окно быстрого поиска в панелях при переключении языка?===
A. Так получилось. ФАР убирает окно поиска при потере и получении фокуса. Включите флажок 'Skip focus events' на вкладке настроек 'Features'.

===Q. Почему нет кнопок мультиконсоли на панели инструментов?===
A. Включите флажок '!MultiCon' в настройке, или ключ /Multi в командной строке.

===Q. Зависает (в заголовке !ConEmu отображается '...Waiting for result (10 sec)') через некоторое время в FAR появляется меню плагинов (или вызывается какой-то другой плагин).===
A. По какой-то причине !ConEmu не смог определить, что Far не отвечает на запросы пользователя (выполняется команда, ожидание, и т.п.).

===Q. Почему не отображается 'Background image'?===
A. По умолчанию, выбранным изображением замещаются только цвета фона #0 и #1 (обычно это черный и синий). В вашей настройке цвета могут быть другими, для явного указания замещаемых цветов можно использовать параметр "bgImageColors".

A. Если флажок 'Background image (bmp)' в третьем состоянии - картинка отображается только в панелях.

A. Если флажок 'Background image (bmp)' включен и файл картинки выбран - проверьте значение 'Darkening'. Возможно там указан 0.

===Q. Зачем нужно подтверждение 'Press Enter to close console...' отображаемое перед закрытием консоли после завершения всех программ в ней?===
A. Если консоль будет сразу закрываться - вы не увидите ни результата выполнения команды, ни сообщений о возможных ошибках в аргументах.

===Q. Как отключить 'Press Enter to close console...'?===
A. Подтверждение закрытия отключается автоматически после того как:
  * корневая консольная программа проработает более 10 секунд, или
  * запускается FAR, как корневой процесс, и в нем загружен плагин !ConEmu.

A. При запуске команды можно добавить параметр `-new_console:n`.

===Q. Запускается FAR, плагин установлен, но все равно появляется 'Press Enter to close console...'?=0==
A. Возможно, в качестве корневого процесса запустился на FAR, а cmd.exe. Проверьте список процессов на вкладке 'Info' в диалоге 'Settings'. Причина - некорректная командная строка (аргумент /cmd в !ConEmu), возможна ошибка в некорректных кавычках.

===Q. Почему Shift-Enter в панелях запускает новое окно с реальной консолью, а не в новой вкладке?=1==
A. Отсутсвует макрос на Shift-Enter или макросы запрещены.

A. Shift-Enter нажат во время 'быстрого поиска' (в этом случае требуется расширенный макрос для макрообласти 'Dialog').

===Q. Почему в консоли отображается прямоугольник (рамка) вместо курсора?=2==
A. Опция 'Block inactive cursor'. Альтернативная индикация, что фокус не в консоли.

===Q. В табах отображаются квадратики (вместо иероглифов).=3==
A. По умолчанию, текст закладок отображается шрифтом "Tahoma". Выберите другой шрифт, содержащий требуемые вам символы (например "Arial Unicode MS"), внеся в реестр:
{{{
[HKEY_CURRENT_USER\Software\ConEmu\.Vanilla]
"TabFontFace"="Arial Unicode MS"
}}}
